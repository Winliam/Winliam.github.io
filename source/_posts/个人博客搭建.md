---
title: 个人博客搭建
categories:
  - - 生活记录
    - 电脑设置
date: 2019-07-08 21:04:15
tags:
  - hexo
  - fluid
  - 看板娘
hide: true
---
## 前言
对于强迫症患者，非要自定义域名的话，先提前注册好域名，推荐阿里云，审核快。不然下面的流程会阻塞。。。

## 安装node.js
1. 去官网 https://nodejs.org 查看最新版本号
2. 根据最新版本号添加源，然后安装
>curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash
>sudo apt-get install -y nodejs<br>
3. 查看版本，确认安装成功
>node -v
>npm -v

## 安装git
上交公钥，然后设置用户名+邮箱
>git config --global user.name "William_2580"
>git config --global user.email "1611134972@qq.com"

## 安装hexo
>npm install -g hexo-cli

## 本地测试
>mkdir hexoblog
>hexo init hexoblog
>hexo server
然后浏览器访问http://localhost:4000, 即可看到部署在本地的个人网站

## 云端部署
1. github创建repo，名称必须为：Winliam.github.io
2. 安装hexo部署工具：
>npm install hexo-deployer-git --save
3. 修改hexoblog下的_config.yml中的deploy段：
```yaml
type: git
repo: git@github.com:Winliam/Winliam.github.io.git
branch: main
```
4. 部署：
>hexo d //public文件夹下的内容被推送到刚才创建的repo中
5. 然后进入repo的setting->pages页面选择正确的分支后，即可通过Winliam.github.io访问blog了

## 自定义域名
1. 阿里云域名注册购买
2. 买到后阿里云中继续设置域名解析，完成后等待10min等DNS生效(使得www.guohongming.xyz和guohongming.xyz都可以被访问到)
3. 在本地public文件夹添加CNAME文件(内容为guohongming.xyz)后重新部署一次
4. 在云端repo的setting->pages页面将guohongming.xyz添加到Custom domain并保存，不用管warning

## 主题美化
  1. 在blog文件夹下
  >npm install --save hexo-theme-fluid
  2. 将GitHub上的[_config.yml](https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml)文件内容复制到本地的_config.fluid.yml中 
  3. 修改本地_config.yml的内容，以应用主题

  ```yaml
	theme: fluid  # 指定主题
	language: zh-CN  # 指定语言，会影响主题显示的语言，按需修改
  ```

此时新建文章后便会自动生成fluid的文章，包括自动生成目录等

## 评论插件
  1. 选型，综合测评，twikoo最好
  2. 注册腾讯云[参考这里](https://blog.zhheo.com/p/2e6bbbd0.html)，建立云开发环境，建立云函数，添加域名，下载秘钥
  3. 将云开发环境的ID写入到fluid的配置yml中
  4. 根据twikoo版本修改，fluid配置yml中的CND地址
  5. 此时部署后已经可以看到插件，此时点击齿轮再将秘钥内容粘贴进去即可设置管理员密码
  6. 注册server酱，注册企业微信，按照server酱官网教程获得SENDKEY，将SENDKEY粘贴到评论插件的管理面板中，有新评论即可通过企业微信通知

## 看板娘
1. 修改npm源，加快下载速度
  > npm config set registry http://registry.npm.taobao.org
2. 安装框架
  > npm install --save hexo-helper-live2d
3. 安装模型
  > npm install --save live2d-widget-model-xxxxx
  > 原装的模型安装方便，但是功能少，高级模型安装麻烦，而且拖慢网页加载速度
4. 修改配置文件（必须是网站的yml）
```yaml
# Live2D
# https://github.com/EYHN/hexo-helper-live2d
live2d:
  enable: true
# enable: false
  scriptFrom: local # 默认
  pluginRootPath: live2dw/ # 插件在站点上的根目录(相对路径)
  pluginJsPath: lib/ # 脚本文件相对与插件根目录路径
  pluginModelPath: assets/ # 模型文件相对与插件根目录路径
# scriptFrom: jsdelivr # jsdelivr CDN
# scriptFrom: unpkg # unpkg CDN
# scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # 你的自定义 url
  tagMode: false # 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中
  debug: false # 调试, 是否在控制台输出日志
  model:
    use: live2d-widget-model-shizuku # npm-module package name
#   use: wanko # 博客根目录/live2d_models/ 下的目录名
#   use: ./wives/wanko # 相对于博客根目录的路径
#   use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # 你的自定义 url
  display:
    position: left
    width: 270
    height: 540
  mobile:
    show: true
    scale: 0.5
```

## 流量统计插件
1. 注册LeanCloud，需要实名验证
2. 创建app
3. 将app的ID, KEY, API地址粘贴到配置文件的相应位置即可
> 计数的对象是文章的发布日期和文章的标题的唯一性组合，修改后将导致重新计数
> 本地的计数无意义

## 创建说说页面
1. 到LeanCloud中创建一个新的app
2. 按照artitalk中的官方说明文档设置这个app
3. 在hexo中新建一个页面
4. 将artitalk中的设置内容copy到新建页面的index.md中
5. 结合fluid设置新页面的layout，导航栏显示位置等属性

## 备份和迁移
1. 基于部署的repo，创建一个新分支source
2. 将以下源文件提交到source分支上
   1. scaffolds
   2. source
   3. themes
   4. _config.fluid.yml
   5. _config.yml
   6. .gitignore
   7. package.json
3. 在新机器上安装node.js，npm，hexo
4. 在新机器上clone source分支
   - 由于是公司电脑，无法修改DNS服务器，因此用不了ssh同步，就使用了https同步，所以上交新机器的ssh公钥可以省了
   - 但是github对于https同步方式有了新的设置方案，需要生成一个token用于clone和depoly。就是说hexo的全局配置文件中的deploy也要改
5. 在新机器上的本地repo下执行npm install，npm会按照package.json中的内容安装依赖
   - 更换npm源为淘宝，以加快下载速度
   - install出现问题可尝试`npm install --force`
6. 测试新机器上的server，deploy等功能
